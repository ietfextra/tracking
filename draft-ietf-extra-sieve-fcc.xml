<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!DOCTYPE rfc SYSTEM 'rfc2629.dtd'
[
<!ENTITY rfc2119 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml'>
<!ENTITY rfc4234 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4234.xml'>
<!ENTITY rfc5228 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5228.xml'>
<!ENTITY rfc5230 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5230.xml'>
<!ENTITY rfc5232 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5232.xml'>
<!ENTITY rfc5321 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5321.xml'>
<!ENTITY rfc5429 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5429.xml'>
<!ENTITY rfc5435 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5435.xml'>
<!ENTITY rfc5490 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5490.xml'>
<!ENTITY rfc6131 PUBLIC ''
'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6131.xml'>
<!ENTITY idSpecialUse PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-extra-sieve-special-use.xml'>
]>

<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc compact="yes"?>
<?rfc strict="yes"?>
<rfc category="std" ipr='trust200902'
     updates="5230, 5435"
     docName='draft-ietf-extra-sieve-fcc-01'>
  <front>
    <title abbrev="Sieve Fcc">Sieve Extension: File Carbon Copy (Fcc)</title>
    <author initials="K." surname="Murchison" fullname="Kenneth Murchison">
      <organization abbrev="FastMail">FastMail Pty Ltd</organization>
      <address>
        <postal>
          <street>Level 2, 114 William Street</street>
          <city>Melbourne</city> <region>VIC</region>
          <code>3000</code> <country>Australia</country>
        </postal>
        <email>murch@fastmailteam.com</email>
      </address>
    </author>

    <author initials="B." surname="Gondwana" fullname="Bron Gondwana">
      <organization abbrev="FastMail">FastMail Pty Ltd</organization>
      <address>
        <postal>
          <street>Level 2, 114 William Street</street>
          <city>Melbourne</city> <region>VIC</region>
          <code>3000</code> <country>Australia</country>
        </postal>
        <email>brong@fastmailteam.com</email>
      </address>
    </author>

    <date />

    <area>ART</area>
    <workgroup>EXTRA</workgroup>

    <keyword>Sieve</keyword>
    <keyword>Vacation</keyword>
    <abstract>
      <t>The Sieve Email Filtering Language provides a number of
      action commands, some of which can generate additional messages
      on behalf of the user.  This document defines an extension to
      such commands to allow a copy of any generated message to be
      filed into a target mailbox.</t>
    </abstract>
  </front>

  <middle>
    <section title='Introduction'>
      <t>The <xref target='RFC5228'>Sieve Email Filtering
      Language</xref> provides a number of action commands, some of
      which can generate additional messages on behalf of the user.
      Two such commands are defined by the
      <xref target='RFC5230'>Vacation</xref> and
      <xref target='RFC5435'>Notify</xref> extensions.
      It is sometimes desirable to have an archive of the
      messages generated by these commands.</t>

      <t>This extension defines a new optional tagged argument ":fcc"
      to action commands which generate additional messages to allow a
      copy of the generated message to be filed into a target
      mailbox.</t>

      <t>The capability string associated with this extension is
      "fcc".</t>

    </section>

    <section title='Conventions Used in This Document'>
      <t>Conventions for notations are as in Section 1.1 of <xref
      target='RFC5228'/>, including use of the "Usage:" label for the
      definition of action and tagged arguments syntax.</t>

      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
      "MAY", and "OPTIONAL" in this document are to be interpreted as
      described in <xref target='RFC2119' />.</t>

    </section>  <!-- Intro -->
    
    <section title='Tagged Argument ":fcc"' anchor='fcc'>

      <figure>
        <artwork><![CDATA[
Usage:   ":fcc" FCC-OPTIONS <mailbox: string>
]]></artwork>
      </figure>

      <figure>
        <preamble>The positional FCC-OPTIONS argument is defined here
        in <xref target='RFC4234'>ABNF</xref> syntax so that it can be
        modified by other extensions.</preamble>
        <artwork><![CDATA[
FCC-OPTIONS = ""  ; empty string
]]></artwork>
      </figure>

      <t>If the optional ":fcc" argument is specified with an action
      that generates an additional message, it instructs the Sieve
      interpreter to file a copy of the generated message into the
      target mailbox.
      If the specified mailbox doesn't exist, the implementation MAY
      treat it as an error, create the mailbox, or file the message into
      an implementation-defined mailbox.</t>

      <section title='Interaction with the Vacation Action'
               anchor='vacation'>

        <t>This document extends the
        <xref target="RFC5230">"vacation"</xref> action (see also
        <xref target="RFC6131">"vacation-seconds"</xref>) to
        optionally store a copy of the auto-reply messages into a
        target mailbox.</t>

      <figure>
        <artwork><![CDATA[
Usage:   vacation [":days" number | ":seconds" number]
                  [":subject" string]
                  [":from" string]
                  [":addresses" string-list]
                  [":mime"]
                  [":handle" string]
                  [":fcc" FCC-OPTIONS <mailbox: string>]
                  <reason: string>
]]></artwork>
      </figure>

      <figure>
        <preamble>Example:</preamble>
        <artwork><![CDATA[
require ["vacation", "fcc"];

vacation :days 7
         :fcc "INBOX.Sent"
         :from "hemingway@example.com" "Gone Fishin'";
]]></artwork>
      </figure>
      </section> <!-- vacation -->

      <section title='Interaction with the Notify Action'
               anchor='notify'>

        <t>This document extends the
        <xref target="RFC5435">"notify"</xref> action to optionally
        store a copy of the notification messages into a target
        mailbox.</t>

      <figure>
        <artwork><![CDATA[
Usage:   notify [":from" string]
                [":importance" <"1" / "2" / "3">]
                [":options" string-list]
                [":message" string]
                [":fcc" FCC-OPTIONS <mailbox: string>]
                <method: string>
]]></artwork>
      </figure>

      <figure>
        <preamble>Example:</preamble>
        <artwork><![CDATA[
require ["enotify", "fcc"];

notify :message "You got mail!"
       :fcc "INBOX.Sent"
       "mailto:ken@example.com";
]]></artwork>
      </figure>
      </section> <!-- notify -->

      <section title='Compatibility with the Reject and Extended Reject
                      Actions' anchor='reject'>

        <t>"fcc" MUST be incompatible with the 
        <xref target='RFC5429'>"reject" and "ereject"</xref> actions.
        Making "fcc" compatible with these actions violates the <xref
        target='RFC5321'>SMTP</xref> principle that a message is
        either delivered or bounced back to the sender.  Namely, the
        saved copy of the rejection message will contain the original
        message.</t>

        <t>It is an error for a script to use the ":fcc" tagged
        argument with either "reject" or "ereject".</t>

      </section> <!-- reject -->

      <section title='Compatibility with Other Actions'
               anchor='other'>

        <t>The "fcc" extension is not compatible with any Sieve action
        that does not generate an additional message on behalf of the
        user.
        It is an error for a script to use the ":fcc" tagged argument
        with any such action.</t>

        <t>Future extensions that define actions that generate
        additional messages on behalf of the user should describe
        their compatibility with ":fcc".</t>

      </section> <!-- other -->

      <section title='Interaction with Fileinto Extensions'
               anchor='fileinto'>

        <t>The "fcc" extension can be used with some tagged arguments
        defined in extensions to the "fileinto" action.  The sections
        below describe its interaction with currently defined
        extensions.
        Tagged arguments in future extensions to the "fileinto" command 
        should describe their interaction with ":fcc", if any.</t>

        <section title='Imap4flags Extension' anchor='imap4flags'>

          <t>This document extends the definition of the <xref
          target='RFC5232'>":flags"</xref> tagged argument so that it
          can be used as an FCC-OPTIONS to the ":fcc" argument.</t>

          <figure>
            <artwork><![CDATA[
FCC-OPTIONS =/ [":flags" <list-of-flags: string-list>]
]]></artwork>
          </figure>

          <t>If the optional ":flags" argument is specified with
          ":fcc", it instructs the Sieve interpreter to set the IMAP4
          flags provided in the subsequent argument when the generated
          message is filed into the target mailbox.</t> 

        </section> <!-- imapflags -->

        <section title='Mailbox Extension' anchor='mailbox'>

          <t>This document extends the definition of the <xref
          target='RFC5490'>":create"</xref> tagged argument so that it 
          can be used as an FCC-OPTIONS to the ":fcc" argument.</t>

          <figure>
            <artwork><![CDATA[
FCC-OPTIONS =/ [":create"]
]]></artwork>
          </figure>

          <t>If the optional ":create" argument is specified with
          ":fcc", it instructs the Sieve interpreter to create the
          target mailbox, if needed, before attempting to file the
          generated message into the target mailbox.</t>

        </section> <!-- mailbox -->

        <section title='Special-Use Extension' anchor='specialuse'>

          <t>This document extends the definition of the <xref
          target='I-D.ietf-extra-sieve-special-use'>":specialuse"</xref> tagged argument
          so that it  can be used as an FCC-OPTIONS to the ":fcc"
          argument.</t>

          <figure>
            <artwork><![CDATA[
FCC-OPTIONS =/ [":specialuse <special-use-flag: string>"]
]]></artwork>
          </figure>

          <t>If the optional ":specialuse" argument is specified with
          ":fcc", it instructs the Sieve interpreter to check whether
          a mailbox exists with the specific special-use flag assigned
          to it.  If such a mailbox exists, the generated message is filed
          into the special-use mailbox.  Otherwise, the generated message
          is filed into the target mailbox.</t>

          <t>If both the optional ":specialuse" and ":create"
          arguments are specified with ":fcc", the Sieve interpreter
          is instructed to create the target mailbox per Section 4.1
          of <xref target='I-D.ietf-extra-sieve-special-use'/>, if
          needed.</t>

        </section> <!-- specialuse -->

        <section title='Extended Example' anchor='example'>

          <figure>
            <artwork><![CDATA[
require ["vacation", "fcc", "mailbox", "special-use", "imap4flags"];

vacation :days 7
         :fcc :specialuse "\\Sent" :create :flags ["\\Seen"] "INBOX.Sent"
         :from "hemingway@example.com" "Gone Fishin'";
]]></artwork>
          </figure>

        </section> <!-- example -->

      </section> <!-- fileinto -->

    </section> <!-- fcc -->

    <section title='Security Considerations' anchor='security'>
      <t>The "fcc" extension does not raise any other security
      considerations that are not already present in <xref
      target='RFC5228'/>, <xref target='RFC5230'/>, <xref
      target='RFC5435'/>, and <xref target='RFC6131'/>.</t>
    </section>

    <section title='IANA Considerations'>

      <section title="Registration of Sieve Extension">
	<t>
	  <list style='empty'>
	    <t>To: iana@iana.org</t>
	    <t>Subject: Registration of new Sieve extension</t>
	    <t>Capability name: fcc</t>
	    <t>Description: Adds the ":fcc" parameter to Sieve action
            commands that generate additional messages.</t>
	    <t>RFC number: RFC XXXX</t>
	    <t>Contact address: The Sieve discussion list
            &lt;sieve@ietf.org&gt;</t>
	  </list>
	</t>
      </section>

    </section> <!-- IANA -->

    <section title='Acknowledgments'>
      <t>The authors would like to thank the following individuals for
      contributing their ideas and support for writing this
      specification: Ned Freed, Stan Kalisch.</t>
    </section>

  </middle>

  <back>
    <references title='Normative References'>
      &rfc2119;
      &rfc4234;
      &rfc5228;
      &rfc5230;
      &rfc5232;
      &rfc5435;
      &rfc5490;
      &idSpecialUse;
    </references>

    <references title='Informative References'>
      &rfc5321;
      &rfc5429;
      &rfc6131;
    </references>

    <section title="Change History (To be removed by RFC Editor before
                    publication)">
      <t>Changes since draft-ietf-extra-sieve-fcc-00: 
      <list style='symbols'>
        <t>Updated abstract with text from Ned.</t>
        <t>Added support for :fcc to notify extension.</t>
        <t>Prohibit use of :fcc with reject and ereject extensions.</t>
        <t>Added registration of the extension with IANA.</t>
        <t>Added Acknowledgments.</t>
        <t>Minor editorial changes.</t>
      </list>
      </t>
    </section>

  </back>
</rfc>
